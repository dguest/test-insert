\chapter{Charm Tagging}

\section{Introduction}
\label{tag:sec:into}

\newcommand{\catpt}{15, 25, 35, 50, 80, 120, 200, $\infty$}
\newcommand{\cateta}{0, 0.7, 1.5, 2.5}
\newcommand{\jfcplotswherefrom}{The jets are from $t \bar{t}$ simulated events generated with \textsc{Powheg+Pythia6}.}

\textbf{NOTE: this section was copied from the JetFitterCharm note, which has since been updated. This section will be updated as well.}

Final states including $c$-jets can arise from a number of interesting processes at the Large Hadron Collider, ranging from Standard Model (SM) $H \to c\bar{c}$ production to SUSY models in which the lightest scalar quark decays to $c$-quarks. In the absence of a designated $c$-jet identification algorithm, such searches are forced to contend with large standard model backgrounds: not only multi-jet production, but also $b$-jet backgrounds from $t\bar{t}$ decays and other electroweak processes can overwhelm a smaller $c$-jet signal. Even assuming such backgrounds can be controlled, in the event of a discovery the searches offer a rather dull probe into the flavor physics of the model. To address these problems, a designated $c$-hadron identification algorithm has been developed and applied to data collected by the ATLAS detector~\cite{DetPap}.

flavor-tagging algorithms within ATLAS fall into two categories: those which identify $b$- and $c$- hadrons by their soft lepton decay products, and those which rely on the displacement of the $b$- and $c$-hadron decay products with respect to the primary vertex. The branching ratio of $c$-hadrons to leptons places an upper limit on the efficiency of soft-lepton based $c$-taggers, which is unacceptably low for many analyses. Lifetime-based methods can be much more efficient.
%% While the identification of $b$-hadron jets with lifetime-based algorithms, referred to as $b$-tagging, is well established at the Large Hadron Collider, $c$-tagging remains relatively unexplored. The lack of designated $c$ taggers results in part from the position that $c$-jets occupy between light and $b$ jets in many distributions.
This note describes the conceptual design, performance, and calibration of JetFitterCharm, a lifetime-based flavor-tagger designed to separate $c$-jets from both light- and $b$-flavored jets.
%------------------- end intro ----------------

%% ------------------------- data and simulation samples --------------------

\section{Data and Simulation Samples}
\label{tag:sec:data-and-simulation}

All following performance plots are produced with $\ttbar$ events corresponding to 8 TeV proton-proton collisions simulated with \textsc{Powheg+Pythia6} and \textsc{CT10} parton distribution functions. Jets are reconstructed by clustering energy deposits in the calorimeter with the anti-$k_t$ algorithm~\cite{antikt} and a radius parameter of 0.4, where clusters are calibrated with local cluster weighting~\cite{JES}. Only jets with $\pt$ above 20 GeV and $|\eta| < 2.5$ are considered.\footnote{ATLAS
  uses a coordinate system with its origin
  at the nominal interaction point (IP) in the centre of the detector
  and the $z$-axis along the beam pipe.
  Cylindrical coordinates $(r,\phi)$ are used in the
  transverse plane, $\phi$ being the azimuthal angle around the beam
  pipe. The pseudorapidity is defined in terms of the polar angle
  $\theta$ as $\eta=-\ln\tan(\theta/2)$, while $\Delta R \equiv \left(\Delta\eta^2 + \Delta \phi^2\right)^{1/2}$.}
To mitigate effects from pileup jets with $\pt < 50\,\gev$ and $|\eta| < 2.4$ are rejected if less than half the sum of track $\pt$ is associated with tracks matched to the primary vertex. The same selection cuts are also applied for the data based calibrations presented in the second part of this document.

flavors{} are assigned to simulated jets by matching them to generator level partons in a $\Delta R < 0.3$ cone. If a $b$-quark is found within the cone the jet is labeled as a $b$-jet. If no $b$-quark is found, the search is repeated for $c$-quarks, then for $\tau$ leptons. If no match is found for $b$, $c$, or $\tau$, the jet is labeled a light-jet.

%% \subsection{flavor Labeling in Simulation}
%% \label{sec:flavor-label}
%% \textbf{ADD BOILER PLATE}

%% --------------------end data and simulation samples --------------------



\section{Algorithm}
\label{tag:sec:algo}
\input{tex/tagging/algorithm}

\section{Operating Points}

While the neural network produces three posterior probabilities, these sum up to 1 by definition and thus contain one redundant degree of freedom. The three outputs are therefore projected into a 2-dimensional ``anti-$b$'' vs ``anti-light'' discriminant plane, where the anti-light axis is defined as $\log P_{c} / P_{\rm light}$ and the anti-$b$ axis as $\log P_{c} / P_{b}$. Operating points are defined by a pair of minimum thresholds: any jet in which both the anti-light and anti-$b$ discriminants exceed the thresholds is said to be ``tagged''.
\begin{figure}
  \begin{center}
  \includegraphics[width=0.5\textwidth]{2d-cut.pdf}
  \caption[JetFitterCharm 2-dimensional cut plane]{
Two-dimensional distribution of the JetFitterCharm anti-$b$ ($\log(P_c/P_b)$) and anti-light ($\log(P_c/P_{\rm light})$) discriminants. The density of red, green, and blue reflect the density of $b$, $c$, and light jets---white areas are a mix of all three flavors, whereas black areas lack any jets. The ``medium'' calibrated operating point selects jets above a certain threshold in both anti-$b$ and anti-light discriminants. Ridge structures arise when the neural network inputs cannot be assigned a physically meaningful value, for example when no secondary vertex is found, and the neural net is given a default value outside the normal physical range. This results in concentrated values in the input space which form the high density streaks.}
  \label{tag:fig:2dcut}
  \end{center}
\end{figure}

Charm-jet tagging, being relatively new to the LHC, is unable to draw on extensive past experience in physics analyses to define ideal operating points. For lack of historical reference, the operating points were defined with a SUSY $\tilde{t}$ pair production search as a prototype. In this particular model, the $\tilde{t}$ quarks decay via $\tilde{t} \to c \tilde{\chi}_1^0$, leading to a two-$c$-jet final state where $c$-tagging is useful to reject Standard Model backgrounds with both light- and $b$-jets. %% This process leads to a final state with a pair of $c$-jets, which can be $c$-tagged in the search. 
Tagging thresholds were allowed to vary independently for each jet while maximizing the expected signal significance. %% $Z$, where \[Z  \equiv \frac{s}{ \sqrt{s + b + (\Delta b)^2}},\] and $s$ and $b$ are respectively the number of signal and background events passing the tagging requirements. The parameter $\Delta b$ accounts for systematic errors in the background, and is fixed at 0.3. 
These studies demonstrated the need for two very different operating points. Anticipating cases where a light jet background dominates, a ``medium'' tag is defined to reject both light- and b-flavored{} jets. In other selections light jets are a smaller background and $\ttbar$ becomes dominant, so a second ``loose'' tag is defined which rejects over half of $b$ jets while accepting a larger fraction of $c$-jets. These operating points are summarized in table~\ref{tag:tab:ops}.

\begin{table}[htb]
\begin{center}
\begin{tabular}{c|c c | c c c }
%% \multicolumn{6}{c}{$\charm$-tagging} \\ \hline
Operating Point & $\log P_c / P_b$ & $\log P_c / P_{\text{light}}$ & $\epsilon_c$ & $1/\epsilon_b$ & $1/\epsilon_{\text{light}}$ \\ \hline
loose & $> -0.9$ & -- & 0.95 & 2.5 & 1.004 \\
medium & $> -0.9$ & $> 0.95$ & 0.19 & 8.0 & 200 \\ \hline
\end{tabular}
\caption[Charm tagging operating points]{Charm tagging operating points. Charm tagging requires two cuts, one to reject $b$ jets, another to reject light jets. The approximate efficiencies for light, $c$, and $b$ jets with $\pt > 20\,\text{GeV}$ as estimated on $\ttbar$ events are also given.}
%GP Dan, are the efficiencies estimated on ttbar events?
\label{tag:tab:ops}
\end{center}
\end{table}


%-------------------- performance ----------------

\section{Performance}
Charm tagging is not amenable to the familiar signal-vs-background efficiency curves typically displayed as performance benchmarks for $b$-tagging. The problem stems from the two-dimensional nature of the discriminant: whereas $b$-tagging defines a single variable onto which jets can be mapped with a clear signal-to-background ordering, the signal versus background-like ordering of two arbitrarily chosen jets in the $\log (P_c/P_b)$--$\log (P_c/P_{\rm light})$ plane is undefined. This lack of definition is intentional, however, and allows extra flexibility when choosing the operating point. In a two-dimensional discriminant plane a given operating point can trade $b$ for light-jet rejection with constant $c$-tagging efficiency.

\begin{figure}
  \begin{center}
  \subfigure[Light-jet rejection vs $c$-tagging efficiency]{
    \includegraphics[width=0.45\textwidth]{jfc-ctag-roc.pdf}
    \label{tag:fig:roc}
    }
  \subfigure[$b$-rejection vs light rejection]{
    \includegraphics[width=0.42\textwidth]{rejrej-simple.pdf}
    \label{tag:fig:rejrej}
  }
  \caption[Several ROC curves for various $b$-jet rejections]{
    \subref{tag:fig:roc} JetFitterCharm light-jet rejection vs $c$-tagging efficiency, where the $b$-rejection ($1/\epsilon_b$) is held fixed.
    \subref{tag:fig:rejrej} Bottom rejection vs. light rejection for constant charm-tagging efficiency. JetFitterCharm operating points select jets above a pair of thresholds in a 2-dimensional discriminant plane, thus for any $c$-tagging efficiency a range of $b$ and $\rm light$ rejections are possible.}
  \end{center}
\end{figure}

Two performance metrics illustrate the above point. The first, shown in figure~\ref{tag:fig:roc}, gives the light-jet rejection as a function of $c$-jet efficiency for all possible values of the anti-light threshold ($x$-axis in figure~\ref{tag:fig:2dcut}). In this case, the anti-$b$ threshold is adjusted to maintain a constant $b$-jet rejection. Equivalent information is given in figure~\ref{tag:fig:rejrej} in the form of $c$-jet constant efficiency contours in the $b$- vs light-rejection plane. Both figures demonstrate the trade off between $b$-jet and light-jet rejection: for constant 30\% $c$-tagging efficiency an operating point can double its $b$ rejection at the expense of cutting the light-jet rejection by a factor of 10.

The $c$-tagging efficiency as a function of $\pt$ and $|\eta|$ for the medium operating point is shown in figure~\ref{tag:fig:medium-eff}. As typical for lifetime-based $b$-tagging algorithms, JetFitterCharm is most efficient when tagging jets with $\pt$ in the 50--250 GeV range.

\begin{figure}
  \begin{center}
\includegraphics[width=0.49\textwidth]{ttbar_mc_efficiency_JetFitterCharm20_pt.pdf}
\includegraphics[width=0.49\textwidth]{ttbar_mc_efficiency_JetFitterCharm20_etaAbs.pdf}\\
\includegraphics[width=0.49\textwidth]{ttbar_mc_efficiency_JetFitterCharm20_pt_log.pdf}
\includegraphics[width=0.49\textwidth]{ttbar_mc_efficiency_JetFitterCharm20_etaAbs_log.pdf}
\caption{Dependence of the tagging efficiency on the jet transverse momentum (left) or pseudorapidity (right) for $b$, $c$, and light-flavor jets for the JetFitterCharm tagger which is a neural network based tagging algorithm specifically designed to select $c$ jets. The selected operating point was chosen to give an average $c$-tagging efficiency of $\approx 20\%$. \jfcplotswherefrom}
  \label{tag:fig:medium-eff}
  \end{center}
\end{figure} 

%% ----------------------------- end performance ---------------

%% ----------------------------- calibration ------------------

\clearpage
\section{Calibration}
\label{tag:sec:calib}
The efficiency for tagging $b$-jets is determined from a measurement performed in dileptonic $t\bar{t}$ events with two or three jets and based on a combinatorial likelihood approach~\cite{Giacinto}. The $c$-jet tagging efficiency has been calibrated in inclusive multijet events from collision data using jets  containing $D^*$ mesons~\cite{bc2014}. Both the $b$- and $c$-jet calibrations are performed as a function of jet transverse momentum and are provided in terms of scale factors. These are defined as the ratio of the tagging efficiency measured in data to the one predicted by simulation and are shown in figure~\ref{tag:JFC_SF_B}.  No significant dependence of the $b$- and $c$-jet scale factors on jet pseudo-rapidity has been found. Corresponding light-jet scale factors are shown in figure~\ref{tag:JFC_SF_L1}, and are derived from a negative-tag analysis~\cite{bc2014}: these are separated in two regions of jet pseudo-rapidity.

\newcommand{\lSF}{as detailed in ATLAS-CONF-2014-046~\cite{bc2014}. The scale factors are measured relative to di-jet Pythia8+EvtGen.} %\ref{lSF}
\newcommand{\cSF}{as detailed in ATLAS-CONF-2014-046~\cite{bc2014}. The scale factors are measured relative to di-jet Pythia8.} %\ref{cSF}
\newcommand{\bSF}{as detailed in ATLAS-CONF-2014-004~\cite{Giacinto}. The scale factors are measured relative to $t \bar{t}$ Powheg+Pythia6.} %\ref{clSF}

\begin{figure}[!h]
  \centering
  \includegraphics[width=0.49\textwidth]{SFs_internal/JetFitterCharm19_C_default_SF_0_00_2_50_oldcalib.pdf}
  \includegraphics[width=0.49\textwidth]{SFs_internal/JetFitterCharm19_B_default_SF_0_00_2_50.pdf}
  \caption{Dependence of the $c$-tagging (left) and $b$-tagging (right) efficiency scale factor on the jet transverse momentum for the JetFitterCharm tagger. The derivation of the $b$-tagging ($c$-tagging) scale factors, shown here relative to $t \bar{t}$ Powheg+Pythia6 (di-jet Pythia8), is detailed in ATLAS-CONF-2014-004~\cite{Giacinto} (ATLAS-CONF-2014-046~\cite{bc2014}).}
  \label{tag:JFC_SF_B}
\end{figure}

\begin{figure}[!htb]
  \centering
  \includegraphics[width=0.49\textwidth]{SFs_internal/JetFitterCharm19_Light_default_SF_0_00_1_20.pdf}
  \includegraphics[width=0.49\textwidth]{SFs_internal/JetFitterCharm19_Light_default_SF_1_20_2_50.pdf}
  \caption{Dependence of the light-jet mistagging efficiency scale factor on the jet transverse momentum, for jet psuedorapity $0.0 < | \eta | < 1.2$ (left) or $1.2 < | \eta | < 2.5$ (right), for the JetFitterCharm tagger, \lSF}
  
  \label{tag:JFC_SF_L1}
\end{figure}

%------------------- end calibration ----------------

%% \section{Conclusions}
%% \label{tag:sec:concl}

%% Lifetime-based $c$-tagging offers a new tool to reduce backgrounds in searches and to measure the flavor-composition of physics processes at the LHC. JetFitterCharm, the first generation of such taggers in ATLAS, combines established $b$-tagging tools to produce a flexible set of $c$-tagging discriminants. With these discriminants a range of operating points can be defined, several of which have now been calibrated on the 2012 $\sqrt{s} = 8 \tev$ dataset. The calibrations are provided in terms of scale factors and related systematic uncertainties, enabling the application of $c$-tagging as a relatively straightforward extension to ATLAS analyses.

\section{The Future of $c$-tagging}
\begin{itemize}
\item Talk about our experiments with deep learning
\item  show performance comparisons between JFC, GAIA
\end{itemize}
