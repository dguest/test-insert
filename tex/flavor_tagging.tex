\chapter{Charm Tagging}

\section{Introduction}
\label{tag:sec:into}

\newcommand{\catpt}{15, 25, 35, 50, 80, 120, 200, $\infty$}
\newcommand{\cateta}{0, 0.7, 1.5, 2.5}
\newcommand{\jfcplotswherefrom}{The jets are from $t \bar{t}$ simulated events generated with \textsc{Powheg+Pythia6}.}

Final states including $c$-jets can arise from a number of interesting processes at the Large Hadron Collider (LHC).
Some of these, including Beyond the Standard Model $H \to c\bar{c}$ production~\cite{charminghiggs} and SUSY models in which the lightest scalar quark decays to $c$-quarks~\cite{stoptocharm}, could be observed in LHC data.
Unfortunately, in the absence of a designated $c$-quark jet ($c$-jet) identification algorithm, such searches are forced to contend with large Standard Model backgrounds: multijet production, $b$-quark jet ($b$-jet) backgrounds from $t\bar{t}$ decays, other electroweak processes, and $H \to b\bar{b}$ production can all overwhelm the $c$-jet signal.
Assuming these backgrounds can be controlled, these searches have little sensitivity to the flavor couplings of a signal.
To address these problems, a dedicated algorithm to identify $c$-jets ($c$-tagging) has been developed and applied to data collected by the ATLAS detector~\cite{DetPap}.

Flavor-tagging algorithms within ATLAS fall into two categories; those which identify $b$- and $c$-hadrons by their soft lepton decay products, and `lifetime-based' methods which rely on the displacement of the $b$- and $c$-hadron decay products with respect to the primary vertex.
The branching ratio of $c$-hadrons to leptons places an upper limit on the efficiency of soft-lepton based $c$-jet tagging algorithms, which restricts their usefulness for many analyses and as such has not been pursued further at this point.
Lifetime-based methods are generally much more efficient and are well established in $b$-jet identification ($b$-tagging), but so far the extension of these methods to $c$-tagging is less developed.

Lifetime-based tagging can be further divided into two general approaches. The first approach is based on the `impact parameter' (IP) of tracks formed by charged particles in the inner tracking detector with respect to the primary vertex. Impact parameter based tagging algorithms exploit the small IP generally associated to tracks within light-flavored ($u$,$d$,$s$,gluon) jets (light-jets). Tracks from heavy hadron decays, by contrast, generally have a larger IP resulting from the displacement of the decay vertex. The second lifetime-based approach involves explicitly reconstructing at least one `secondary vertex' (SV) from tracks within the jet and categorizing the jet based on the SV properties.

A lifetime-based $c$-tagging algorithm must discriminate against two major backgrounds, $b$- and light-jets, and for most characteristics $c$-jets lie between these two extremes, making isolating
them particularly challenging.
In terms of light-jet discrimination, $c$-tagging algorithms are less powerful than $b$-tagging algorithms as a result of the smaller decay vertex displacement for $c$-hadrons relative to $b$-hadrons\footnote{The mean $c\tau$, where $\tau$ is the particle's lifetime, for a $B$ meson is $\approx 492$~$\mu$m, while $c\tau$ for a $D^{\pm}$ ($D^0$) 
meson is only $\approx 312$ ($\approx 123$) $\mu$m~\cite{pdg2014}.}.
This results in smaller impact parameters and lower SV reconstruction efficiency, and thus in a significantly lower $c$-tagging efficiency to reach a light-jet rejection equal to that achieved by $b$-tagging algorithms.
On the other hand, it can be difficult to distinguish $c$-hadron candidates from $b$-hadrons because both can form a displaced SV
and $b$-hadrons overwhelmingly decay via $c$-hadrons~\cite{pdg2014}. Faced with these complications, the best discriminating variables between $b$- and $c$-jets are the secondary vertex properties, in particular the invariant mass of the charged particles forming the secondary vertex.

Despite the limitations, lifetime-based tagging algorithms are within the capabilities of the detector and require only minor additions to the existing $b$-tagging tools. This chapter describes the design of
one such tagging algorithm, JetFitterCharm, and presents the expected performance and calibration on 2012 data.
For Run 2 the additional new innermost pixel layer inserted into the ATLAS detector during 2014, denoted the Insertable B-Layer~\cite{IBLTDR}, is likely to increase $c$-tagging performance by significantly improving the impact parameter resolution for low momentum tracks.

%------------------- end intro ----------------

%% ------------------------- data and simulation samples --------------------

\section{Data and Simulation Samples}
\label{tag:sec:data-and-simulation}

Plots in this chapter are produced with $\ttbar$ events corresponding to 8 TeV proton-proton collisions simulated with \textsc{Powheg+Pythia6}~\cite{bib:powheg,pythia2} and \textsc{CT10}~\cite{CT10} parton distribution functions. Only $t\bar{t}$ decays with at least one downstream lepton are included. To simulate pileup, minimum bias interactions consistent with 2012 run conditions are generated with \textsc{Pythia8}~\cite{Pythia8} and overlaid on the $\ttbar$ events.
The propagation of particles through the detector and the detector response are modeled using \textsc{GEANT4}~\cite{geant}. The primary vertex is defined as the vertex with the largest sum of squared transverse momenta of the associated tracks.

Jets are reconstructed by clustering energy deposits in the calorimeter with the anti-$k_t$ algorithm~\cite{antikt} and a radius parameter of 0.4, where clusters are calibrated with local cluster weighting~\cite{LCJets}. Jet energy scale calibration and criteria to reject low quality jets are standard across most analyses of 2012 data, and are described in detail elsewhere~\cite{JES}. In this note, only jets with transverse momentum, $\pt$, above 20 GeV and $|\eta| < 2.5$ are considered.
To mitigate effects from pileup, jets with $\pt < 50\,\gev$ and $|\eta| < 2.4$ are rejected if less than half of the sum of track $\pt$ is associated with tracks matched to the primary vertex~\cite{2013JVF}. The same selection cuts are also applied for the data based calibrations presented in the second part of this document.

In the case of simulated jets, a flavor label is assigned by matching jets to generator level partons with $\pt > 5\,\gev$, after final state radiation, in a $\Delta R < 0.3$ cone. If a $b$-quark is found within the cone the jet is labeled as a $b$-jet. If no $b$-quark is found, the search is repeated for $c$-quarks, then for $\tau$ leptons. If no match is found for $b$, $c$, or $\tau$, the jet is labeled as a light-jet.

%% --------------------end data and simulation samples --------------------



\section{Algorithm}
\label{tag:sec:algo}
\input{tex/tagging/algorithm}

\section{Operating Points}

While the neural network produces three posterior probabilities, these sum up to 1 by definition and thus contain one redundant degree of freedom. The three outputs are therefore projected into a 2-dimensional ``anti-$b$'' vs ``anti-light'' discriminant plane, where the anti-light axis is defined as $\log P_{c} / P_{\rm light}$ and the anti-$b$ axis as $\log P_{c} / P_{b}$. Operating points are defined by a pair of minimum thresholds: any jet in which both the anti-light and anti-$b$ discriminants exceed the thresholds is said to be ``tagged''.
\begin{figure}
  \begin{center}
  \includegraphics[width=0.5\textwidth]{2d-cut.pdf}
  \caption[JetFitterCharm 2-dimensional cut plane]{
Two-dimensional distribution of the JetFitterCharm anti-$b$ ($\log(P_c/P_b)$) and anti-light ($\log(P_c/P_{\rm light})$) discriminants. The density of red, green, and blue reflect the density of $b$, $c$, and light jets---white areas are a mix of all three flavors, whereas black areas lack any jets. The ``medium'' calibrated operating point selects jets above a certain threshold in both anti-$b$ and anti-light discriminants. Ridge structures arise when the neural network inputs cannot be assigned a physically meaningful value, for example when no secondary vertex is found, and the neural net is given a default value outside the normal physical range. This results in concentrated values in the input space which form the high density streaks.}
  \label{tag:fig:2dcut}
  \end{center}
\end{figure}

Charm-jet tagging, being relatively new to the LHC, is unable to draw on extensive past experience in physics analyses to define ideal operating points. For lack of historical reference, the operating points were defined with a SUSY $\tilde{t}$ pair production search as a prototype. In this particular model, the $\tilde{t}$ quarks decay via $\tilde{t} \to c \tilde{\chi}_1^0$, leading to a two-$c$-jet final state where $c$-tagging is useful to reject Standard Model backgrounds with both light- and $b$-jets. %% This process leads to a final state with a pair of $c$-jets, which can be $c$-tagged in the search. 
Tagging thresholds were allowed to vary independently for each jet while maximizing the expected signal significance. %% $Z$, where \[Z  \equiv \frac{s}{ \sqrt{s + b + (\Delta b)^2}},\] and $s$ and $b$ are respectively the number of signal and background events passing the tagging requirements. The parameter $\Delta b$ accounts for systematic errors in the background, and is fixed at 0.3. 
These studies demonstrated the need for two very different operating points. Anticipating cases where a light jet background dominates, a ``medium'' tag is defined to reject both light- and b-flavored{} jets. In other selections light jets are a smaller background and $\ttbar$ becomes dominant, so a second ``loose'' tag is defined which rejects over half of $b$ jets while accepting a larger fraction of $c$-jets. These operating points are summarized in table~\ref{tag:tab:ops}.

\begin{table}[htb]
\begin{center}
\begin{tabular}{c|c c | c c c }
%% \multicolumn{6}{c}{$\charm$-tagging} \\ \hline
Operating Point & $\log P_c / P_b$ & $\log P_c / P_{\text{light}}$ & $\epsilon_c$ & $1/\epsilon_b$ & $1/\epsilon_{\text{light}}$ \\ \hline
loose & $> -0.9$ & -- & 0.95 & 2.5 & 1.004 \\
medium & $> -0.9$ & $> 0.95$ & 0.19 & 8.0 & 200 \\ \hline
\end{tabular}
\caption[Charm tagging operating points]{Charm tagging operating points. Charm tagging requires two cuts, one to reject $b$ jets, another to reject light jets. The approximate efficiencies for light, $c$, and $b$ jets with $\pt > 20\,\text{GeV}$ as estimated on $\ttbar$ events are also given.}
%GP Dan, are the efficiencies estimated on ttbar events?
\label{tag:tab:ops}
\end{center}
\end{table}


%-------------------- performance ----------------

\section{Performance}
Charm tagging is not amenable to the familiar signal-vs-background efficiency curves typically displayed as performance benchmarks for $b$-tagging. The problem stems from the two-dimensional nature of the discriminant: whereas $b$-tagging defines a single variable onto which jets can be mapped with a clear signal-to-background ordering, the signal versus background-like ordering of two arbitrarily chosen jets in the $\log (P_c/P_b)$--$\log (P_c/P_{\rm light})$ plane is undefined. This lack of definition is intentional, however, and allows extra flexibility when choosing the operating point. In a two-dimensional discriminant plane a given operating point can trade $b$ for light-jet rejection with constant $c$-tagging efficiency.

\begin{figure}
  \begin{center}
  \subfigure[Light-jet rejection vs $c$-tagging efficiency]{
    \includegraphics[width=0.45\textwidth]{jfc-ctag-roc.pdf}
    \label{tag:fig:roc}
    }
  \subfigure[$b$-rejection vs light rejection]{
    \includegraphics[width=0.42\textwidth]{rejrej-simple.pdf}
    \label{tag:fig:rejrej}
  }
  \caption[Several ROC curves for various $b$-jet rejections]{
    \subref{tag:fig:roc} JetFitterCharm light-jet rejection vs $c$-tagging efficiency, where the $b$-rejection ($1/\epsilon_b$) is held fixed.
    \subref{tag:fig:rejrej} Bottom rejection vs. light rejection for constant charm-tagging efficiency. JetFitterCharm operating points select jets above a pair of thresholds in a 2-dimensional discriminant plane, thus for any $c$-tagging efficiency a range of $b$ and $\rm light$ rejections are possible.}
  \end{center}
\end{figure}

Two performance metrics illustrate the above point. The first, shown in figure~\ref{tag:fig:roc}, gives the light-jet rejection as a function of $c$-jet efficiency for all possible values of the anti-light threshold ($x$-axis in figure~\ref{tag:fig:2dcut}). In this case, the anti-$b$ threshold is adjusted to maintain a constant $b$-jet rejection. Equivalent information is given in figure~\ref{tag:fig:rejrej} in the form of $c$-jet constant efficiency contours in the $b$- vs light-rejection plane. Both figures demonstrate the trade off between $b$-jet and light-jet rejection: for constant 30\% $c$-tagging efficiency an operating point can double its $b$ rejection at the expense of cutting the light-jet rejection by a factor of 10.

The $c$-tagging efficiency as a function of $\pt$ and $|\eta|$ for the medium operating point is shown in figure~\ref{tag:fig:medium-eff}. As typical for lifetime-based $b$-tagging algorithms, JetFitterCharm is most efficient when tagging jets with $\pt$ in the 50--250 GeV range.

\begin{figure}
  \begin{center}
\includegraphics[width=0.49\textwidth]{ttbar_mc_efficiency_JetFitterCharm20_pt.pdf}
\includegraphics[width=0.49\textwidth]{ttbar_mc_efficiency_JetFitterCharm20_etaAbs.pdf}\\
\includegraphics[width=0.49\textwidth]{ttbar_mc_efficiency_JetFitterCharm20_pt_log.pdf}
\includegraphics[width=0.49\textwidth]{ttbar_mc_efficiency_JetFitterCharm20_etaAbs_log.pdf}
\caption{Dependence of the tagging efficiency on the jet transverse momentum (left) or pseudorapidity (right) for $b$, $c$, and light-flavor jets for the JetFitterCharm tagger which is a neural network based tagging algorithm specifically designed to select $c$ jets. The selected operating point was chosen to give an average $c$-tagging efficiency of $\approx 20\%$. \jfcplotswherefrom}
  \label{tag:fig:medium-eff}
  \end{center}
\end{figure} 

%% ----------------------------- end performance ---------------

%% ----------------------------- calibration ------------------

\clearpage
\section{Calibration}
\label{tag:sec:calib}
The efficiency for tagging $b$-jets is determined from a measurement performed in dileptonic $t\bar{t}$ events with two or three jets and based on a combinatorial likelihood approach~\cite{Giacinto}. The $c$-jet tagging efficiency has been calibrated in inclusive multijet events from collision data using jets  containing $D^*$ mesons~\cite{bc2014}. Both the $b$- and $c$-jet calibrations are performed as a function of jet transverse momentum and are provided in terms of scale factors. These are defined as the ratio of the tagging efficiency measured in data to the one predicted by simulation and are shown in figure~\ref{tag:JFC_SF_B}.  No significant dependence of the $b$- and $c$-jet scale factors on jet pseudo-rapidity has been found. Corresponding light-jet scale factors are shown in figure~\ref{tag:JFC_SF_L1}, and are derived from a negative-tag analysis~\cite{bc2014}: these are separated in two regions of jet pseudo-rapidity.

\newcommand{\lSF}{as detailed in ATLAS-CONF-2014-046~\cite{bc2014}. The scale factors are measured relative to di-jet Pythia8+EvtGen.} %\ref{lSF}
\newcommand{\cSF}{as detailed in ATLAS-CONF-2014-046~\cite{bc2014}. The scale factors are measured relative to di-jet Pythia8.} %\ref{cSF}
\newcommand{\bSF}{as detailed in ATLAS-CONF-2014-004~\cite{Giacinto}. The scale factors are measured relative to $t \bar{t}$ Powheg+Pythia6.} %\ref{clSF}

\begin{figure}[!h]
  \centering
  \includegraphics[width=0.49\textwidth]{SFs_internal/JetFitterCharm19_C_default_SF_0_00_2_50_oldcalib.pdf}
  \includegraphics[width=0.49\textwidth]{SFs_internal/JetFitterCharm19_B_default_SF_0_00_2_50.pdf}
  \caption{Dependence of the $c$-tagging (left) and $b$-tagging (right) efficiency scale factor on the jet transverse momentum for the JetFitterCharm tagger. The derivation of the $b$-tagging ($c$-tagging) scale factors, shown here relative to $t \bar{t}$ Powheg+Pythia6 (di-jet Pythia8), is detailed in ATLAS-CONF-2014-004~\cite{Giacinto} (ATLAS-CONF-2014-046~\cite{bc2014}).}
  \label{tag:JFC_SF_B}
\end{figure}

\begin{figure}[!htb]
  \centering
  \includegraphics[width=0.49\textwidth]{SFs_internal/JetFitterCharm19_Light_default_SF_0_00_1_20.pdf}
  \includegraphics[width=0.49\textwidth]{SFs_internal/JetFitterCharm19_Light_default_SF_1_20_2_50.pdf}
  \caption{Dependence of the light-jet mistagging efficiency scale factor on the jet transverse momentum, for jet psuedorapity $0.0 < | \eta | < 1.2$ (left) or $1.2 < | \eta | < 2.5$ (right), for the JetFitterCharm tagger, \lSF}
  
  \label{tag:JFC_SF_L1}
\end{figure}

%------------------- end calibration ----------------

%% \section{Conclusions}
%% \label{tag:sec:concl}

%% Lifetime-based $c$-tagging offers a new tool to reduce backgrounds in searches and to measure the flavor-composition of physics processes at the LHC. JetFitterCharm, the first generation of such taggers in ATLAS, combines established $b$-tagging tools to produce a flexible set of $c$-tagging discriminants. With these discriminants a range of operating points can be defined, several of which have now been calibrated on the 2012 $\sqrt{s} = 8 \tev$ dataset. The calibrations are provided in terms of scale factors and related systematic uncertainties, enabling the application of $c$-tagging as a relatively straightforward extension to ATLAS analyses.

\section{The Future of $c$-tagging}
\begin{itemize}
\item Talk about our experiments with deep learning
\item  show performance comparisons between JFC, GAIA
\end{itemize}
